<!DOCTYPE html>
<html lang="en">
  <head>
    <style type="text/css">
      .tg  {border-collapse:collapse;border-spacing:0;}
      .tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
      .tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
      .tg .tg-lkh3{background-color:#9aff99}
      .tg .tg-huad{background-color:#ffccc9}
      .tg .tg-e3zv{font-weight:bold}
      .tg .tg-lkhz{background-color:#9aff99}
      .tg .tg-e3zz{font-weight:bold}
      .tg .tg-pznz{background-color:#fdddb7}
      .tg .tg-s6z2{text-align:center}
      .tg .tg-a9he{font-weight:bold;font-size:16px;font-family:Arial, Helvetica, sans-serif !important;;background-color:#343434;color:#ffffff;text-align:center}
      .tg .tg-465v{font-weight:bold;background-color:#9b9b9b;text-align:center}
      .tg .tg-psr3{font-weight:bold;background-color:#9b9b9b;color:#000000;text-align:center}
      @media screen and (max-width: 767px) {.tg {width: auto !important;}.tg col {width: auto !important;}.tg-wrap {overflow-x: auto;-webkit-overflow-scrolling: touch;}}
      #red, #green, #blue {
      margin: 10px;
      display: inline-block;
      height: 200px;
      }
      #colorpicker {
      height: 240px;
      width: 310px;
      margin: 0 auto;
      padding: 10px;
      border: 1px solid #BFBFBF;
      }
      #result {
      margin: 60px 26px;
      height: 100px;
      width: 100px;
      display: inline-block;
      vertical-align: top;
      color: rgb(127, 127, 127);
      background: rgb(127, 127, 127);
      border: 1px solid #fff;
      box-shadow: 0 0 10px;
      }
      #red {
      background: #c0392b;
      }
      #green {
      background: #27ae60;
      }
      #blue {
      background: #2980b9;
      }
      #spreadslider{
      background-color: #1ED5DE;
      }
      .ui-slider-range{
      background-color: #D8D8D8;
      }
      .tg th .z{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 20px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
      .tg .tg-azzz{font-weight:bold;font-size:16px;font-family:Arial, Helvetica, sans-serif !important;;background-color:#343434;color:#ffffff;text-align:center}
      .tg .tg-4zzz{font-weight:bold;background-color:#9b9b9b;text-align:center}
      .tg .tg-pzzz{font-weight:bold;background-color:#9b9b9b;color:#000000;text-align:center}
      .btn-default:focus,
      .btn-default:active,
      .btn-default.active
      {
      background-color: #ffffff;
      }
      .btn-default:hover
      {
      background-color: #ebebeb;
      }
      .redCell
      {
        background-color: #ff9933;
        outline: 1px solid red;
        outline-offset: -1px;

      }

      @font-face {
        font-family: 'Roundo';
        font-style: normal;
        font-weight: normal;
        src: local('Roundo'), url('fonts/Roundo-Light.otf') format('truetype');
      }

      #titleBarText {
        font-family: 'Roundo';
        font-size:24px;
        color : #ffffff;
        margin: 0 auto;
        padding: 0;
        text-align: center;
        width: 99%;
        padding-top: 10px;


      }

      .stop-scrolling {
        height:100%;
        overflow: hidden;
      }

    </style>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Dashbug</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/png">
    <!-- Bootstrap Core CSS-->
    <link href="css/bootstrap.css" rel="stylesheet">
    <!-- Custom Fonts-->


  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/jquery-ui.min.js" type="text/javascript"></script>

    <link rel="stylesheet" type="text/css" media="all" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/themes/base/jquery-ui.css" />
    <link rel="stylesheet" type="text/css" media="all" href="http://fonts.googleapis.com/css?family=Acme" />

    <!-- RR: This will give us nice tables (jqGrid) and a consistent theme (uilight)-->
    <link rel="stylesheet" type="text/css" media="screen" href="css/jquery-ui.css" />

    <link rel="stylesheet" type="text/css" media="screen" href="css/ui.jqgrid.css" />
     
    <script src="javascripts/i18n/grid.locale-en.js" type="text/javascript"></script>
    <script src="javascripts/jquery.jqGrid.min.js" type="text/javascript"></script>


    
    <script src="javascripts/moment.min.js" type="text/javascript"></script>
    <script src="javascripts/hammer.min.js" type="text/javascript"></script>

    <script src="javascripts/socket.io.js" type="text/javascript"></script>
    
    <script src="javascripts/chart.js/dist/Chart.bundle.js" type="text/javascript"></script>
    <script src="javascripts/Chart.Zoom.js/Chart.Zoom.js" type="text/javascript"></script>
    <script src="javascripts/Blob.js" type="text/javascript"></script>
    

  </head>
  <body>

    <div id="wrapper" style="padding-left:0px;">
      <!-- Navigation-->
      <nav role="navigation" class="navbar navbar-inverse navbar-fixed-top">
        <!-- Brand and toggle get grouped for better mobile display-->
        
        <div class="navbar-header" style="width: 99%; height: 99%">
          <button type="button" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div id="titleBarText">Datrium</div>
         <!--
          <ul style="margin-top:8px; font-size:18px;" class="nav navbar-nav">
            <li class="active"><a href="#"><i class="fa fa-fw fa-home"></i>Home</a></li>
            <li><a href="#"><i class="fa fa-fw fa-wifi"></i>Manual Trader</a></li>
            <li><a href="pnl"><i class="fa fa-fw fa-search"></i>P & L</a></li>
            <li><a href="#"><i class="fa fa-fw fa-file"></i>Help</a></li>
          </ul>
          -->
        </div>
        
        <!-- Sidebar Menu Items - These collapse to the responsive navigation menu on small screens-->
        <!--
        <div class="collapse navbar-collapse navbar-ex1-collapse">
        <ul class="nav navbar-nav side-nav" style="width:195px; top:47px; margin-top:15px !important;">
        <li class="active">
        <a href="#"><i class="fa fa-fw fa-home"></i>Home</a>
        </li>
        <li>
        <a href="#"><i class="fa fa-fw fa-wifi"></i>Connect To Station</a>
        </li>
        <li>
        <a href="#"><i class="fa fa-fw fa-search"></i>Inspect Station</a>
        </li>
        </ul>
        </div>
        -->
        <!-- /.navbar-collapse-->
        <!--<h1 style="color:white; font-size:30px !important; margin-top:15px;">Blaze Datrium</h1>-->
      </nav>

      <div id="page-wrapper">
        <div class="container-fluid">
          <!-- Page Heading-->
          <div style="height:80px;" class="row"></div>
          <div style="" class="row" id = "datum_details_container">
            <div  class="col-lg-12">
              <div class="panel panel-default" >
                <div class="panel-heading">
                  <h3 class="panel-title"><i style="margin-right:8px;" class="fa fa-cubes fa-fw"></i>Datum Details</h3>
                </div>
                <div style="padding-left:0px; padding-right:0px; margin-right:30px; padding-top:20px; padding-bottom:0px; height: 400px; width:100%;" class="panel-body">
                  <!-- *********************************************************************************-->
                  <div class="col-md-12" style="display: inline-block; height:100%; float: left;" id = "item_plot_container">
                    <canvas id="item_plot" style="height:100%"> </canvas>
                    <div id="datumPlotProgressBar"></div>

                    <script>
                      //$('#datumPlotProgressBar').progressbar({value: 0});
                      //$('#datumPlotProgressBar').hide();
                    </script>
                  </div>

                  <!-- *********************************************************************************-->
                
                <div class="col-md-3" id="datum_details_sidebar" style=" background-color: #f5f5f5;  float: right; height: 95%; margin-right: 20px;" >
                    <div style="width:100%; margin: 0 auto; display: block;" class="row"  >
                      <select id= "datum_details_sidebar_combobox" name= "datum_details_sidebar_combobox" style=" width:100%; margin: 0 auto; background-color: #f5f5f5; margin-top: 10px;">
                        <option></option>
                      </select>
                    </div> 
                    <div class="row" id="datum_details_sidebar_textbox" style="width:100%; margin: 0 auto;">
                      <textarea id="datum_details_textbox" name="datum_details_textbox" style=" height: 300px;  width:100%; margin: 0 auto; margin-top: 15px; font-size: 10px; background-color: #f5f5f5; overflow: scroll"></textarea>
                    </div> 
                </div>

                <script>
                  $("#datum_details_sidebar").hide();
                  $('#datum_details_container').hide();
                </script>

                <!-- *********************************************************************************-->


            </div>
          </div>
        </div>
      </div>
          <script>
            
          </script>


          <div style="height:500px;" class="row" id="grid_container">
            <div id="item_grid" class="col-lg-12">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title"><i style="margin-right:8px" class="fa fa-exclamation fa-fw"></i>Datum List</h3>
                </div>
                <div style="padding-left:0px; padding-right:0px; padding-top:0px; padding-bottom:0px;" class="panel-body" >
                  <!-- *********************************************************************************-->
                  <div>
                    <table id="item_list"></table>
                    <div id="item_list_pager" ></div>
                  </div>
                  <div id="jqGridProgressBar"></div>
                  <script type="text/javascript">


                    $("#item_list").jqGrid({
                      datatype: "local",
                      height: 300,
                      responsive: true,
                      autowidth: true,
                        colNames:['Datum ID','Computer ID', 'Date', 'User', 'Blaze Version', 'Last Open Window', 'Last Action' , 'Last Exception', 'Application RAM (kB)', 'Network Usage (B/s)'],
                        colModel:[
                          {name:'dumpID', index:'dumpID', width: 110, sorttype:'string', searchoptions:{sopt:['eq','ne','cn', 'nc', 'ew', 'en']}},
                          {name:'computerID',index:'computerID',  sorttype:'string', searchoptions:{sopt:['eq','bw','bn','cn','nc','ew','en']}},
                          {name:'dumpDate',index:'dumpDate', width:240, sorttype:'date',datefmt: 'yyyy-m-d h:i:s',   searchoptions:{sopt:['eq','bw','bn','cn','nc','ew','en']}},
                          {name:'loginName',index:'loginName', width:110, sorttype:'string', searchoptions:{sopt:['eq','bw','bn','cn','nc','ew','en']}},
                          {name:'blazeVersion',index:'blazeVersion', sorttype: 'string', searchoptions:{sopt:['eq','bw','bn','cn','nc','ew','en']}},
                          {name:'windowHistory',index:'windowHistory',  sorttype:'string', searchoptions:{sopt:['eq','ne','le','lt','gt','ge']}},
                          {name:'actionHistory',index:'actionHistory', sorttype:'string', searchoptions:{sopt:['eq','bw','bn','cn','nc','ew','en']}},
                          {name:'sessionExceptions',index:'sessionExceptions', sorttype:'string', searchoptions:{sopt:['eq','bw','bn','cn','nc','ew','en']}},
                          {name:'applicationRam',index:'applicationRam',  sorttype:'decimal', searchoptions:{sopt:['eq','ne','le','lt','gt','ge']}},
                          {name:'networkUsage',index:'networkUsage', sorttype:'integer', searchoptions:{sopt:['eq','bw','bn','cn','nc','ew','en']}}

                        ],
                        mtype: "GET",
                        rowNum:25,
                      rowTotal: 200,
                      rownumbers: true,
                      defaults:
                      {
                          emptyrecords: "No records to view",
                          loadtext: "Loading records..."
                      },
                      rownumWidth: 40,
                      gridview: true,
                      pgbuttons: true,
                      pager: '#item_list_pager',
                      sortname: 'dumpDate',
                      viewrecords: true,
                      sortorder: 'desc',
                      caption: "" ,
                      viewsortcols: [true, 'vertical', true],
                      onSelectRow: function(id, status, e) 
                      { 
                        rowClickEventHandler(id,status, e);
                      },
                      onCellSelect: function(rowID, iCol, cellContent, e)
                      {
                        cellSelectEventHandler(rowID, iCol, cellContent, e);
                      }


                    }).navGrid("#item_list_pager",
                    {
                      search: false,
                      edit: false,
                      add: false,
                      del: false,
                      refresh: false
                    },
                    {}, // default settings for edit
                    {}, // default settings for add
                    {}, // delete
                    {
                        closeOnEscape: true, closeAfterSearch: true, ignoreCase: true, multipleSearch: false, multipleGroup: false, showQuery: false,
                        sopt: ['cn', 'eq', 'ne'],
                        defaultSearch: 'cn'
                    }).navButtonAdd('#item_list_pager', {
                        caption: "Export to Excel",
                        buttonicon: "ui-icon-disk",
                        onClickButton: function () {
                            saveJSONToCSV();
                        },
                        position: "last"
                    });
                    

                    //$('#jqGridProgressBar').hide();
                    $("#item_list").jqGrid('filterToolbar',{searchOperators : true});
                    $("#item_list").setGridWidth($('#item_grid').width()-20);
                    //$('#datum_details_container').hide();
                  </script>
                  <!-- *********************************************************************************-->
                </div>
              </div>
            </div>
          </div>
          <!-- /.row-->
          <!-- /.row-->
        </div>
        <!-- /.container-fluid-->
      </div>
      <!-- /#page-wrapper-->
    </div>
    <!-- /#wrapper-->
    <!-- set up the rangeslider-->
    <script>

     var socket = io();
     var dumpLookupTable={};

     function enableScrolling()
     {
      $('body').removeClass('stop-scrolling');
     }

     function disableScrolling()
     {
      $('body').addClass('stop-scrolling');
     }

     

     function cellSelectEventHandler(rowID, iCol, cellContent, e)
     {
        /*console.log("CELL CLICK:");
        console.log(rowID);
        console.log(iCol);
        console.log(cellContent);
        console.log(e.currentTarget);
        console.log(e.target);
        console.log(e);

        console.log(e.target);

        if(lastClickedCell != null)
        {
          $(lastClickedCell).toggleClass('redCell');
        }

        lastClickedCell = e.target;



        $(e.target).toggleClass('redCell');



        if(rowID == e.delegateTarget.p.selrow)
        {
          jQuery("#item_list").setCell(rowID, iCol, '', {border: '2px solid #ff0000' });
        }

        */

     }

     function replaceAll(str, replace, with_this)
    {
        var str_hasil ="";
        for(var i=0;i<str.length;i++)
        {
            if (str[i] == replace)
            {
                var temp = with_this;
            }
            else
            {
                var temp = str[i];
            }
            str_hasil += temp;
        }
        var result = str_hasil.toString();
        return result;
    }


     //array of options should be an array of value - object pairs like [ {value: "TaskList", text: "Task List"}, { ....} ]
     function setComboboxItems($selectElement, arrayOfOptions, comboboxChangedHandler)
     {
      console.log("SET COMBO ITEMS");
      console.log($selectElement);
      console.log(arrayOfOptions);
      $selectElement.empty();
      $.each(arrayOfOptions, function(index, optionObject)
      {
        $selectElement.append("<option value='" + optionObject.value + "'>" + optionObject.text + "</option>");
      });
      $selectElement.on('change', function(){ return comboboxChangedHandler();})


     }

     function JSON2CSV(JSONData, newFileName, ShowLabel) 
     {
        //If JSONData is not an object then JSON.parse will parse the JSON string in an Object
        console.log(JSONData);
        var arrData = typeof JSONData != 'object' ? JSON.parse(JSONData) : JSONData;
        
        var CSV = '';    
        //Set Report title in first row or line
        
        CSV += newFileName + '\r\n\n';

        //This condition will generate the Label/Header
        if (ShowLabel && false) {
            var row = "";
            
            //This loop will extract the label from 1st index of on array
            for (var index in arrData[0]) {
                
                //Now convert each value to string and comma-seprated
                row += index + ',';
            }

            row = row.slice(0, -1);
            
            //append Label row with line break
            CSV += row + '\r\n';
        }
        
        //1st loop is to extract each row
        for (var i = 0; i < arrData.length; i++) {
            var row = "";
            
            //2nd loop will extract each column and convert it in string comma-seprated
            for (var index in arrData[i]) {
                row += '"' + arrData[i][index] + '",';
            }

            row.slice(0, row.length - 1);
            
            //add a line break after each row
            CSV += row + '\r\n';
        }

        if (CSV == '') {        
            alert("Invalid data");
            return;
        }   
        
        //Generate a file name
        var fileName = newFileName;
        
        //Initialize file format you want csv or xls
        var uri = 'data:text/csv;charset=utf-8,' + escape(CSV);
        
        // Now the little tricky part.
        // you can use either>> window.open(uri);
        // but this will not work in some browsers
        // or you will not get the correct file extension    
        
        //this trick will generate a temp <a /> tag
        var link = document.createElement("a");    
        link.href = uri;
        
        //set the visibility hidden so it will not effect on your web-layout
        link.style = "visibility:hidden";
        link.download = fileName + ".csv";
        
        //this part will append the anchor tag and remove it after automatic click
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

    
      }

     function saveJSONToCSV()
     {
      alert("This feature has not been implemented yet.");
        //var data = jQuery('#item_list').jqGrid('getRowData');

        //JSON2CSV(data, "Grid Data", true); 
     }

     function yyyymmdd(date) 
     {
          var mm = date.getMonth() + 1; // getMonth() is zero-based
          var dd = date.getDate();

          return (date.getFullYear() + "-" + mm + "-" + dd);
      };

      function addCommasToNumber(x) 
      {
        while (/(\d+)(\d{3})/.test(x.toString()))
        {
          x = x.toString().replace(/(\d+)(\d{3})/, '$1'+','+'$2');
        }
        return x;
      }

     socket.on('fill_session_data_table', function(data)
     {
          //convert data to array, then feed to jqgrid
            console.log("Fill table command received...");

            jQuery("#item_list").jqGrid("clearGridData");

            //$('#jqGridProgressBar').show();
            //$('#jqGridProgressBar').progressbar({value:0});

            for(var i=0; i<data.length; i++)
            {
              console.log(data[i]);

              data[i].lastUpdateTime = new Date();
              dumpLookupTable[data[i].dumpID] = $.extend({}, data[i]); //shallow copy
              
              addNewRowToGrid(data[i]);
              //$('#jqGridProgressBar').progressbar({value:Math.round(100*(i+1)/(data.length))});
              
            }
           // $('#jqGridProgressBar').hide();

            console.log("Fill table completed.");
      
     });




     function addNewRowToGrid(jsonData)
     {
      //this is poorly done, ill fix if speed in the dashbug client becomes an issue
      jsonData.data = jsonData;

      if(jsonData.windowHistory.length > 0)
        jsonData.windowHistory= addCommasToNumber(jsonData.windowHistory[0][Object.keys(jsonData.windowHistory[0])[0]]);
      else
        jsonData.windowHistory = "N/A";

      if(jsonData.applicationRam.length > 0)
        jsonData.applicationRam= addCommasToNumber(jsonData.applicationRam[0][Object.keys(jsonData.applicationRam[0])[0]]);
      else
        jsonData.applicationRam = "N/A";

      if(jsonData.networkUsage.length > 0)
        jsonData.networkUsage= addCommasToNumber(jsonData.networkUsage[0][Object.keys(jsonData.networkUsage[0])[0]]);
      else
        jsonData.networkUsage = "N/A";

      if(jsonData.sessionExceptions.length > 0)
        jsonData.sessionExceptions= addCommasToNumber(jsonData.sessionExceptions[0][Object.keys(jsonData.sessionExceptions[0])[0]]);
      else
        jsonData.sessionExceptions = "N/A";

      if(jsonData.actionHistory.length > 0)
        jsonData.actionHistory= addCommasToNumber(jsonData.actionHistory[0][Object.keys(jsonData.actionHistory[0])[0]]);
      else
        jsonData.actionHistory =  "N/A";

      jsonData.loginName = jsonData.loginName + " (" + String(jsonData.userType) + ":" + String(jsonData.entityName) + ")";


      jsonData.dumpDate = new Date(String(jsonData.dumpDate) + " " + String(jsonData.timeAtStartup));


      $("#item_list").jqGrid('addRowData', jsonData.dumpID, jsonData);
     }

     //this will resize the jqgrid when the window changes size
     $(window).bind('resize', function() 
     {
        $("#item_list").setGridWidth($('#item_grid').width()-4);
      }).trigger('resize');





     //this is the row click event handler for jqgrid
     var lastID = 0;

     var lastClickedCell = null;

     function rowClickEventHandler(clickedDumpID, selectionStatus, e)
     {
      if(e.which == 1)
      {
        //left click
        console.log("ROW CLICK:");

        var fullItemJSON = dumpLookupTable[clickedDumpID];

        if(lastClickedCell != null)
        {
          $(lastClickedCell).removeClass('redCell');
        }

        if(selectionStatus == true)
        {
          //select new row


          $("#datum_details_sidebar_textbox").hide();
          $('#datum_details_sidebar').hide();
          $('#datum_details_sidebar_combobox').hide();
          $('#item_plot_container').removeClass('col-md-8');
          $('#item_plot_container').addClass('col-md-12');
          
          drawDatumDetailsPlot(fullItemJSON);


          
        }
        else
        {
          //highlight selected cell and pull up data
          console.log("CELL HIGHLIGHT");
          //console.log(e.target.cellIndex);

          var cellIndex = e.target.cellIndex;
          var colModel = $('#item_list').jqGrid("getGridParam", "colModel");
          var columnName = colModel[cellIndex].index;

          

          lastClickedCell = e.target;



          $(e.target).addClass('redCell');

          $("#datum_details_sidebar_textbox").hide();
          $('#datum_details_sidebar_combobox').hide();
          $('#datum_details_sidebar').hide();
          

          
          

          if(columnName == "windowHistory")
          {

            $("#datum_details_textbox").val(JSON.stringify(fullItemJSON.windowHistory, null, 2));

            $('#item_plot_container').removeClass('col-md-12');
            $('#item_plot_container').addClass('col-md-8');
            $("#datum_details_sidebar_textbox").show();
            $('#datum_details_sidebar').show();
          }
          else if(columnName == "actionHistory")
          {
            $("#datum_details_textbox").val(JSON.stringify(fullItemJSON.actionHistory, null, 2));



            $('#item_plot_container').removeClass('col-md-12');
            $('#item_plot_container').addClass('col-md-8');
            $("#datum_details_sidebar_textbox").show();
            $('#datum_details_sidebar').show();


          }
          else if(columnName == "applicationRam")
          {
            $("#datum_details_textbox").val(JSON.stringify(fullItemJSON.applicationRam, null, 2));

            $('#item_plot_container').removeClass('col-md-12');
            $('#item_plot_container').addClass('col-md-8');
            $("#datum_details_sidebar_textbox").show();
            $('#datum_details_sidebar').show();
          }
          else if(columnName == "networkUsage")
          {
            var boxText = "Network Usage";
            boxText+='\n';
            boxText += "Connection Info: " + fullItemJSON.connectionInfo + "      \nLocal IP: " + fullItemJSON.localIP;
                $("#datum_details_textbox").val(overviewString);
            boxText += '\n';
            boxText += JSON.stringify(fullItemJSON.networkUsage, null, 2);
            $("#datum_details_textbox").val(boxText);

            $('#item_plot_container').removeClass('col-md-12');
            $('#item_plot_container').addClass('col-md-8');
            $("#datum_details_sidebar_textbox").show();
            $('#datum_details_sidebar').show();
          }
          else if(columnName == "sessionExceptions")
          {
            $("#datum_details_textbox").val(JSON.stringify(fullItemJSON.sessionExceptions, null, 2));

            $('#item_plot_container').removeClass('col-md-12');
            $('#item_plot_container').addClass('col-md-8');
            $("#datum_details_sidebar_textbox").show();
            $('#datum_details_sidebar').show();
          }
          else if(columnName == "dumpDate")
          {
            $('#item_plot_container').removeClass('col-md-8');
            $('#item_plot_container').addClass('col-md-12');
          }
          else if(columnName == "dumpID")
          {
            $("#datum_details_textbox").val(JSON.stringify(fullItemJSON.dumpID, null, '\t'));
            var arrayOfOptions = [ {value: "Overview" , text: "Overview" } , {value: "TaskList", text:"Task List"}, {value: "Log", text:"Log"}];

            var overviewString = "Overview: \n";
                overviewString += "Datum ID: " + fullItemJSON.dumpID + "\n";
                overviewString += "Date: " + fullItemJSON.dumpDate + "      Startup Time: " + fullItemJSON.timeAtStartup + "\n";
                overviewString += "Last Update: " + fullItemJSON.lastUpdateTime +"\n";
                overviewString += "Computer ID: " + fullItemJSON.computerID + "\n";
                overviewString += "Blaze Version: " + fullItemJSON.blazeVersion + "\n";
                overviewString += "Login: " + fullItemJSON.loginName + "   Entity Name: " + fullItemJSON.entityName + "    User Type: " + fullItemJSON.userType +"\n";
                overviewString += "Connection Info: " + fullItemJSON.connectionInfo + "\n";
                overviewString += "Local IP: " + fullItemJSON.localIP + "\n";
                overviewString += "RAM: " + fullItemJSON.systemRAM +"GB \n";
                overviewString += "Processor: " + fullItemJSON.processorInfo + "\n";
                
                overviewString += "Application Directory: " + fullItemJSON.currentDirectory +"\n";


            var eventHandler = function()
            {

              console.log("EVENT!!!");

              var cboxText = $('#datum_details_sidebar_combobox option:selected').text();


              if(cboxText == "Overview")
              {
                $("#datum_details_textbox").val(overviewString);

              }
              else if(cboxText == "Task List")
              {
                $("#datum_details_textbox").val(String(fullItemJSON.taskList));
              }
              else if(cboxText == "Log")
              {
                $("#datum_details_textbox").val(fullItemJSON.logMessages);

              }
            };

            setComboboxItems($('#datum_details_sidebar_combobox'), arrayOfOptions, eventHandler);

            $("#datum_details_textbox").val(overviewString);

            $('#item_plot_container').removeClass('col-md-12');
            $('#item_plot_container').addClass('col-md-8');


            $('#datum_details_sidebar').show();
            $("#datum_details_sidebar_textbox").show();
            $('#datum_details_sidebar_combobox').show();

          }
          else if(columnName == "computerID")
          {
            //socket.emit("computerID_match_request", fullItemJSON.computerID);

            socket.on("computerID_match_response", function(data)
            {
              //buildPerformanceDataDisplay(data);
            });
            //$("#datum_details_textbox").val(JSON.stringify(fullItemJSON.computerID, null, '\t'));
            //$('#datum_details_sidebar_combobox').show();

            
            
          }


        }

        lastID = clickedDumpID;
      }
     }

     function buildPerformanceDataDisplay(data)
     {
      //first, we have to calculate the numbers

      //data contains all the entries with a matching computerID



     }


      var chartObject = null;

      function drawOverviewPlots(data)
      {
        //show a pie chart of windows opened 

      }
     function drawDatumDetailsPlot(data)
     {
          console.log("Drawing Action History Plot...");

          $('#datumPlotProgressBar').show();

          $('#datum_details_container').show(500);
          var progressIndex = 0;

          var actionHistory = data.actionHistory;
          var sessionExceptions = data.sessionExceptions;
          var windowHistory = data.windowHistory;
          var applicationRAM = data.applicationRam;
          var networkUsage = data.networkUsage;

          var actionHistoryKeyList = Object.keys(data.actionHistory);
          var sessionExceptionsKeyList = Object.keys(data.sessionExceptions);
          var windowHistoryKeyList = Object.keys(data.windowHistory);
          var applicationRAMKeyList = Object.keys(data.applicationRam);

          var networkUsageKeyList = Object.keys(data.networkUsage);


          var actionHistoryArray = [];
          var sessionExceptionsArray = [];
          var windowHistoryArray = [];
          var applicationRAMArray = [];
          var networkUsageArray = [];

          var applicationRamAverage=0;
          var applicationRamMax = 0;

          var date = new Date(data.dumpDate);

          var totalItemCount = applicationRAMKeyList.length + 2* networkUsageKeyList.length
          + actionHistoryKeyList.length + windowHistoryKeyList.length + sessionExceptionsKeyList.length + actionHistoryKeyList.length;

          //build ram list
          for(var i=0; i<applicationRAMKeyList.length; i++)
          {
            var tempKeys = Object.keys(data.applicationRam[i]);

            var time = String(tempKeys[0]);

            var value = parseInt(data.applicationRam[i][time]);


            applicationRamAverage += value;
            if(applicationRamMax < value)
            {
              applicationRamMax = value;
            }

            time=yyyymmdd(date) + " " + time;
            applicationRAMArray.push({"x" : time, "type" : "RAM Usage" , "value" : value, "y" : value});

          }


          if(applicationRAMKeyList.length > 0)
            applicationRamAverage=applicationRamAverage/applicationRAMKeyList.length;
          else 
            applicationRamAverage=0;


          var networkUsageAverage=0;
          var networkUsageMax=0;

          //calculate average network usage
          for(var i=0; i<networkUsageKeyList.length; i++)
          {
            var tempKeys = Object.keys(data.networkUsage[i]);
            var time = tempKeys[0];
            var value = parseInt(data.networkUsage[i][time]);
            networkUsageAverage += value;

            if(value>networkUsageMax)
              networkUsageMax = value;
          }

          //calculate scaling factor for network usage plot
          if(networkUsageKeyList.length > 0)
            networkUsageAverage=networkUsageAverage/networkUsageKeyList.length;
          else
            networkUsageAverage=0;


          var networkUsageScalingFactor=0;
          if(networkUsageAverage>0) 
            networkUsageScalingFactor =  applicationRamMax/networkUsageMax;
          else 
            networkUsageScalingFactor = 0;


          //now, build the network usage plot
          for(var i=0; i<networkUsageKeyList.length; i++)
          {
            var tempKeys = Object.keys(data.networkUsage[i]);
            var time = tempKeys[0];
            var value = parseInt(data.networkUsage[i][time]);

            time=yyyymmdd(date) + " " + time;

            var yVal = networkUsageScalingFactor*value;

            networkUsageArray.push({"x" : time, "type" : "Network Usage" , "value": value, "y" : yVal});

          }

          //build action history plot
          for(var i=0; i<data.actionHistory.length; i++)
          {
            //var tempKeys = Object.values(data.actionHistory[i]);
            var object = data.actionHistory[i];
            var keys = Object.keys(data.actionHistory[i]);
            var value = data.actionHistory[i][keys[0]];
            var time = String(keys[0]);

            console.log(time);
            console.log(value);

            time=yyyymmdd(date) + " " + time;

            actionHistoryArray.push({"x" : time, "type" : "Action History" , "value" : value, "y": applicationRamMax/8});

          }

          //build session exceptions list, beward creating points on top of points
          for(var i=0; i<data.sessionExceptions.length; i++)
          {
            var object = data.sessionExceptions[i];
            var keys = Object.keys(data.sessionExceptions[i]);
            var value = data.sessionExceptions[i][keys[0]];
            var time = String(keys[0]);

            time=yyyymmdd(date) + " " + time;


            sessionExceptionsArray.push({"x" : time, "type" : "Session Exceptions" , "value" : value, "y": applicationRamMax/4});

          }
          for(var i=0; i<data.windowHistory.length; i++)
          {
            var object = data.windowHistory[i];
            var keys = Object.keys(data.windowHistory[i]);
            var value = data.windowHistory[i][keys[0]];
            var time = String(keys[0]);

            time=yyyymmdd(date) + " " + time;


            windowHistoryArray.push({"x" : time, "type" : "Window History" , "value" : value, "y": applicationRamMax/1.7});

          }

          var context = document.getElementById("item_plot");

          if(context != null)
          {
            context=context.getContext("2d");
          }

          if(chartObject != null)
            chartObject.destroy();

          console.log("maxes: " + applicationRamMax + "   " + networkUsageMax);

          chartObject = new Chart(context,
          {
            type: 'line',
            pan: {enabled: true, mode: 'x'},
            zoom: {enabled: true, mode:'xy'},
            data:
            {
              datasets: [
              {
                label: "Actions",
                showLine: false,
                pointStyle: "crossRot",
                pointRadius: 4,
                pointHoverRadius: 6, 
                fill:false,
                data: actionHistoryArray,
                pointBackgroundColor: '#000000', //black
                pointBorderColor: '#000000',
                backgroundColor: '#000000',
                borderColor: '#000000'

              },
              {
                label: "Opened Windows",
                showLine: false,
                pointStyle: "rect",
                pointRadius: 8,
                pointHoverRadius: 10, 
                fill: false,
                spanGaps: false,
                data: windowHistoryArray,
                pointBackgroundColor: 'rgb(0, 204, 0)', //green
                pointBorderColor: 'rgb(0, 204, 0)',
                backgroundColor: 'rgb(0, 204, 0)',
                borderColor: 'rgb(0, 204, 0)'
              },
              {
                label: "Exceptions",
                showLine: false,
                pointStyle: "triangle",
                pointRadius: 8,
                pointHoverRadius: 10, 
                fill: false,
                data: sessionExceptionsArray,
                pointBackgroundColor: 'rgb(255, 51, 0)', //light red
                pointBorderColor: 'rgb(255, 51, 0)',
                backgroundColor: 'rgb(255, 51, 0)',
                borderColor: 'rgb(255, 51, 0)'
              },
              {
                label: "Normalized Network Usage (bytes/sec, scaled " + String(1024*Math.round(networkUsageScalingFactor, 2)) + "x)",
                data: networkUsageArray, 
                fill: false,
                borderColor: '#00ffff',
                backgroundColor: '#00ffff'
              },
              {
                label: "Blaze Working RAM (kB)",
                data: applicationRAMArray,
                fill: false,
                borderColor: '#990000',
                backgroundColor: '#cccccc'

              }
            ]
          },
            options: 
            {
              
              title: {fontSize: 16, display: true, text: data.dumpDate +" " +  data.timeAtStartup +"     " + data.loginName +" (" + data.userType + ":" +data.entityName +")     " + data.dumpID},
              responsive: true,
              maintainAspectRatio: false,
              display: true,
              pan: {enabled: true, mode: 'x'},
              zoom: {enabled: true, mode: 'x'},
              legend: { display: true , position: "bottom"},
              hover: {mode: 'label'},
              tooltips: 
              {
                mode: 'x-axis', 
                callbacks:
                {
                  label: function(tooltipItem, data)
                  {
                    var thisData = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];
                    
                    var type = thisData.type;

                    if(type == "Window History")
                    {
                      return thisData.value + " Window";
                    }
                    else if(type =="Network Usage")
                    {
                      return "Network: " + addCommasToNumber(thisData.value) + "B/s";

                    }
                    else if(type =="RAM Usage")
                    {
                      return "RAM: " + addCommasToNumber(thisData.value) +"kB"
                    }
                    else if(type =="Action History")
                    {
                      return thisData.value;
                    }
                    else if(type =="Session Exceptions")
                    {
                      return thisData.value;
                    }
                    else
                      return thisData.value;
                  }

                }
              },

              scales: 
              {
                xAxes: [{
                  display:true,
                  type: "time",
                  time: { unit: 'second', unitStepSize: 1},
                  displayFormat: {unit: 'minute'},
                  position: 'bottom',
                  padding: 0,
                  ticks: {autoSkip: true, padding: 20, display: true},
                  scaleLabel: 
                  {
                    display: true,
                    labelString: 'Time',
                    fontStyle: 'bold',
                    fontSize: 14
                  }
                }],
                yAxes: [{
                  display: true,
                  position: "left",
                  type: "linear",
                  ticks:{
                    display: true,
                    //max: Math.round(applicationRamMax*1.2, 0),
                    min: 0,
                     userCallback: function(tick) {
                      return addCommasToNumber(Math.round(tick));
                    }},
                  scaleLabel: 
                  {
                    display: true,
                    labelString: 'RAM Usage (kB)',
                    fontStyle: 'bold',
                    fontSize: 14
                  }
                        
                }]
              }
              
            }

          });
            //draw labels for the event
          $('#datumPlotProgressBar').hide();
          //$('#datum_details_container').show(500);
          console.log("Finished drawing timeline.");
        }
        
    

     //keep this after all the socket listener initializations
     socket.emit("initialization_data_request", {});
  </script>
  </body>
</html>